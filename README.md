# ðŸ“¨ iOS SMS Forwarder to WeChat (Cloudflare Worker)

è¿™æ˜¯ä¸€ä¸ªéƒ¨ç½²åœ¨ **Cloudflare Workers** ä¸Šçš„è½»é‡çº§è„šæœ¬ï¼Œé…åˆ iOS å¿«æ·æŒ‡ä»¤è‡ªåŠ¨åŒ–ï¼Œå®žçŽ°å°† iPhone æ”¶åˆ°çš„çŸ­ä¿¡ï¼ˆç‰¹åˆ«æ˜¯éªŒè¯ç ï¼‰æ¯«ç§’çº§è½¬å‘åˆ° **ä¼ä¸šå¾®ä¿¡ï¼ˆWeComï¼‰**ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

* **â˜ï¸ Serverless éƒ¨ç½²**ï¼šå®Œå…¨ä¾æ‰˜ Cloudflare Workersï¼Œå…è´¹ç‰ˆé¢åº¦è¶³å¤Ÿä¸ªäººä½¿ç”¨ï¼Œæ— éœ€è´­ä¹°æœåŠ¡å™¨ã€‚
* **ðŸš€ æžé€ŸæŽ¨é€**ï¼šåˆ©ç”¨ iOS å¿«æ·æŒ‡ä»¤è§¦å‘ï¼Œæ¯«ç§’çº§é€è¾¾ã€‚
* **ðŸ“± å¾®ä¿¡å…¼å®¹**ï¼šé‡‡ç”¨çº¯æ–‡æœ¬æ¶ˆæ¯æ ¼å¼ï¼Œ**æ™®é€šå¾®ä¿¡**å…³æ³¨ä¼ä¸šå¾®ä¿¡æ’ä»¶åŽå¯ç›´æŽ¥æŽ¥æ”¶ï¼ŒæŽ’ç‰ˆæ•´æ´ã€‚
* **ðŸ” æ™ºèƒ½æå–**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶æå–çŸ­ä¿¡ä¸­çš„éªŒè¯ç ã€‚
* **ðŸ›¡ï¸ é˜²é‡å¤å‘é€**ï¼šåˆ©ç”¨ Cloudflare KV æ•°æ®åº“è¿›è¡Œæ¶ˆæ¯æŒ‡çº¹åŽ»é‡ï¼Œé˜²æ­¢ iOS å¿«æ·æŒ‡ä»¤é‡å¤è§¦å‘ã€‚
* **ðŸ’¾ åŽ†å²å¤‡ä»½**ï¼šçŸ­ä¿¡å†…å®¹è‡ªåŠ¨å­˜å…¥ KV æ•°æ®åº“ï¼Œä¿ç•™ 30 å¤©ï¼Œæ–¹ä¾¿å›žæº¯ã€‚
* **ðŸŒ æ—¶åŒºè‡ªå®šä¹‰**ï¼šæ”¯æŒè‡ªå®šä¹‰æ—¶åŒºï¼ˆå¦‚ `Asia/Seoul`, `Asia/Shanghai`ï¼‰ï¼Œç¡®ä¿æ˜¾ç¤ºæ—¶é—´å‡†ç¡®ã€‚

## ðŸ› ï¸ å‡†å¤‡å·¥ä½œ

1. **Cloudflare è´¦å·**ï¼šç”¨äºŽéƒ¨ç½² Worker å’Œ KVã€‚
2. **ä¼ä¸šå¾®ä¿¡è´¦å·**ï¼š
* æ³¨å†Œä¼ä¸šå¾®ä¿¡ï¼ˆä¸ªäººå¯æ³¨å†Œï¼‰ã€‚
* åˆ›å»ºä¸€ä¸ªâ€œåº”ç”¨â€ (Agent)ï¼ŒèŽ·å– `AgentId` and `Secret`ã€‚
* èŽ·å–ä¼ä¸š ID (`CorpId`)ã€‚
* **é‡è¦**ï¼šåœ¨åº”ç”¨çš„â€œå¯è§èŒƒå›´â€ä¸­æ·»åŠ ä½ è‡ªå·±ï¼Œå¦åˆ™æ”¶ä¸åˆ°æ¶ˆæ¯ã€‚



## ðŸš€ éƒ¨ç½²æ­¥éª¤ (ç½‘é¡µç‰ˆ Dashboard)

å¦‚æžœä½ ä¸æƒ³ä½¿ç”¨å‘½ä»¤è¡Œï¼Œå¯ä»¥ç›´æŽ¥åœ¨æµè§ˆå™¨æ“ä½œï¼š

### 1. åˆ›å»º Worker

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)ã€‚
2. è¿›å…¥ **Workers & Pages** -> **Create Application** -> **Create Worker**ã€‚
3. å‘½åä¸º `sms-forwarder`ï¼Œç‚¹å‡» **Deploy**ã€‚
4. ç‚¹å‡» **Edit Code**ï¼Œå°†æœ¬é¡¹ç›® `worker.js` çš„å®Œæ•´ä»£ç ç²˜è´´è¿›åŽ»è¦†ç›–åŽŸå†…å®¹ã€‚
* *æ³¨æ„ï¼šä»£ç é¡¶éƒ¨çš„ `const TIME_ZONE = "Asia/Seoul";` å¯æŒ‰éœ€ä¿®æ”¹ã€‚*



### 2. åˆ›å»º KV æ•°æ®åº“ (ç”¨äºŽåŽ»é‡å’Œå­˜å‚¨)

1. åœ¨ Cloudflareä¾§è¾¹æ ç‚¹å‡» **Storage & Databases** -> **KV**ã€‚
2. ç‚¹å‡» **Create a Namespace**ï¼Œå‘½åä¸º `SMS_CACHE`ï¼Œç‚¹å‡» Addã€‚
3. å›žåˆ°ä½ çš„ Worker é¡µé¢ -> **Settings** -> **Bindings**ã€‚
4. ç‚¹å‡» **Add** -> **KV Namespace**ã€‚
* **Variable name**: `SMS_CACHE` (å¿…é¡»å¤§å†™ï¼Œå®Œå…¨ä¸€è‡´)ã€‚
* **KV Namespace**: é€‰æ‹©åˆšæ‰åˆ›å»ºçš„æ•°æ®åº“ã€‚


5. ä¿å­˜å¹¶ **Deploy**ã€‚

### 3. é…ç½®çŽ¯å¢ƒå˜é‡

åœ¨ Worker é¡µé¢ -> **Settings** -> **Variables**ï¼Œæ·»åŠ ä»¥ä¸‹çŽ¯å¢ƒå˜é‡ï¼š

| å˜é‡å | ç¤ºä¾‹å€¼ | è¯´æ˜Ž |
| --- | --- | --- |
| `API_TOKEN` | `mySuperSecretPassword` | è‡ªå®šä¹‰å¯†ç ï¼Œç”¨äºŽ iOS å¿«æ·æŒ‡ä»¤é‰´æƒ |
| `WECOM_CORPID` | `wwdxxxxxxxxxxxx` | ä¼ä¸šå¾®ä¿¡ CorpID |
| `WECOM_SECRET` | `FromWeComAppSecret` | åº”ç”¨ Secret |
| `WECOM_AGENTID` | `1000001` | åº”ç”¨ AgentID |

## ðŸ“± iOS å¿«æ·æŒ‡ä»¤é…ç½®

è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. **æ–°å»ºè‡ªåŠ¨åŒ–**ï¼š
* æ‰“å¼€â€œå¿«æ·æŒ‡ä»¤â€ App -> è‡ªåŠ¨åŒ– -> ç‚¹å‡» `+`ã€‚
* é€‰æ‹© **â€œä¿¡æ¯â€**ã€‚
* **å‘ä»¶äºº**ï¼šé€‰æ‹©â€œä»»ä½•äººâ€ã€‚
* **ä¿¡æ¯åŒ…å«**ï¼šç•™ç©ºï¼ˆæˆ–å¡«å…¥å…³é”®è¯å¦‚â€œéªŒè¯ç â€ï¼‰ã€‚
* **è¿è¡Œ**ï¼šé€‰æ‹© **â€œç«‹å³è¿è¡Œâ€**ã€‚
* **è¿è¡Œæ—¶é€šçŸ¥**ï¼šå»ºè®®å…³é—­ã€‚


2. **ç¼–è¾‘åŠ¨ä½œ**ï¼š
* **åŠ¨ä½œ 1**: æœç´¢å¹¶æ·»åŠ  **â€œèŽ·å–æ–‡æœ¬â€** (Get Text from Input)ã€‚
* è¾“å…¥æºé€‰æ‹©ï¼š**â€œå¿«æ·æŒ‡ä»¤è¾“å…¥â€** (Shortcut Input)ã€‚


* **åŠ¨ä½œ 2**: æœç´¢å¹¶æ·»åŠ  **â€œèŽ·å– URL çš„å†…å®¹â€** (Get Contents of URL)ã€‚
* **URL**: `https://ä½ çš„workeråŸŸå.workers.dev` (æˆ–ä½ ç»‘å®šçš„è‡ªå®šä¹‰åŸŸå)ã€‚
* **æ–¹æ³•**: `POST`ã€‚
* **å¤´éƒ¨ (Headers)**:
* `Authorization`: `Bearer ä½ çš„API_TOKEN` (æ³¨æ„ Bearer åŽæœ‰ç©ºæ ¼)ã€‚


* **è¯·æ±‚ä½“ (Request Body)**: é€‰æ‹© `JSON`ã€‚
* `content`: **[æ–‡æœ¬]** (é€‰æ‹©åŠ¨ä½œ1èŽ·å–çš„é‚£ä¸ªæ–‡æœ¬å˜é‡ï¼Œä¸è¦ç›´æŽ¥é€‰å¿«æ·æŒ‡ä»¤è¾“å…¥ï¼Œé˜²æ­¢æ ¼å¼é”™è¯¯)ã€‚
* `device`: `iPhone` (æ‰‹åŠ¨è¾“å…¥è®¾å¤‡å)ã€‚
* `timestamp`: `å½“å‰æ—¥æœŸ` (å¯é€‰)ã€‚







## ðŸ“ å¸¸è§é—®é¢˜ (FAQ)

### Q: æ—¶é—´æ˜¾ç¤ºä¸æ­£ç¡®ï¼Ÿ

A: è¯·åœ¨ `worker.js` ä»£ç é¡¶éƒ¨æ‰¾åˆ° `const TIME_ZONE`ï¼Œä¿®æ”¹ä¸ºä½ æ‰€åœ¨çš„æ—¶åŒºï¼Œä¾‹å¦‚ `"Asia/Shanghai"` (ä¸­å›½) æˆ– `"Asia/Seoul"` (éŸ©å›½)ã€‚

### Q: å“ªé‡ŒæŸ¥çœ‹å¤‡ä»½çš„çŸ­ä¿¡ï¼Ÿ

A: ç™»å½• Cloudflare -> **Storage & Databases** -> **KV** -> ç‚¹å‡» `SMS_CACHE` -> **View**ã€‚ä»¥ `log:` å¼€å¤´çš„ Key å°±æ˜¯å¤‡ä»½çš„çŸ­ä¿¡ã€‚

## ðŸ“„ License

MIT License. Feel free to modify and distribute.
